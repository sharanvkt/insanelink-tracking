/**
 * InsaneLink Tracking Script v1.0.0
 * Used to track landing page views for InsaneLink URL shortener
 * https://github.com/sharanvkt/insanelink-tracking
 */
!function(){const e="https://linkmetrics-gamma.vercel.app/api/track";function n(){try{const e=new URLSearchParams(window.location.search),n=e.get("insanelink_visitor"),o=e.get("insanelink_id");if(!n||!o)return void console.log("InsaneLink: No tracking parameters found in URL");console.log(`InsaneLink: Recording page view for link ${o}`);t({visitorId:n,linkId:o,type:"page",url:window.location.href,referrer:document.referrer,timestamp:Date.now(),userAgent:navigator.userAgent,performanceData:{pageLoadTime:performance.now(),connectionType:navigator.connection?navigator.connection.effectiveType:null,deviceMemory:navigator.deviceMemory||null,screenWidth:window.screen.width,screenHeight:window.screen.height}},0),setTimeout((function(){try{if(window.history&&window.history.replaceState){const e=new URL(window.location.href);e.searchParams.delete("insanelink_visitor"),e.searchParams.delete("insanelink_id"),window.history.replaceState({},document.title,e.toString()),console.log("InsaneLink: Cleaned URL parameters")}}catch(e){console.error("InsaneLink: URL cleaning error:",e)}}),500)}catch(e){console.error("InsaneLink tracking error:",e)}}function t(n,i){if(navigator.sendBeacon)try{const t=new Blob([JSON.stringify(n)],{type:"application/json"});if(navigator.sendBeacon(e,t))return void console.log("InsaneLink: Successfully tracked page view using Beacon API")}catch(e){console.warn("InsaneLink: Beacon API failed, falling back to fetch",e)}try{console.log("InsaneLink: Attempting to track with fetch API",n.linkId),fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),keepalive:!0,mode:"cors",credentials:"omit"}).then((e=>(console.log("InsaneLink: Fetch response status:",e.status),e.ok?e.json():e.json().then((n=>{throw new Error(`HTTP error! status: ${e.status}, message: ${JSON.stringify(n)}`)}))))).then((e=>{console.log("InsaneLink: Successfully tracked page view using fetch",e)})).catch((e=>{console.warn("InsaneLink: Fetch API failed",e),i<3?setTimeout((()=>{console.log(`InsaneLink: Retrying (${i+1}/3)...`),t(n,i+1)}),1e3*Math.pow(2,i)):o(n)}))}catch(e){console.error("InsaneLink: All tracking methods failed",e),o(n)}}function o(e){try{console.log("InsaneLink: Using pixel fallback method");const n={v:e.visitorId,l:e.linkId,t:Date.now(),r:encodeURIComponent(document.referrer).substring(0,100)},t=`https://linkmetrics-gamma.vercel.app/api/track-pixel?d=${encodeURIComponent(JSON.stringify(n))}`;(new Image).src=t}catch(e){console.error("InsaneLink: Pixel tracking failed",e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n()}))}();
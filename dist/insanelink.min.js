/**
 * InsaneLink Tracking Script v1.0.0
 * Used to track landing page views for InsaneLink URL shortener
 * https://github.com/your-username/insanelink-tracking
 */
!function(){const e="https://linkmetrics-gamma.vercel.app/api/track";function n(){try{const e=new URLSearchParams(window.location.search),n=e.get("insanelink_visitor"),i=e.get("insanelink_id");if(!n||!i)return;console.log(`InsaneLink: Recording page view for link ${i}`);t({visitorId:n,linkId:i,type:"page",url:window.location.href,referrer:document.referrer,timestamp:Date.now(),userAgent:navigator.userAgent,performanceData:{pageLoadTime:performance.now(),connectionType:navigator.connection?navigator.connection.effectiveType:null,deviceMemory:navigator.deviceMemory||null,screenWidth:window.screen.width,screenHeight:window.screen.height}},0),setTimeout((function(){try{if(window.history&&window.history.replaceState){const e=new URL(window.location.href);e.searchParams.delete("insanelink_visitor"),e.searchParams.delete("insanelink_id"),window.history.replaceState({},document.title,e.toString()),console.log("InsaneLink: Cleaned URL parameters")}}catch(e){console.error("InsaneLink: URL cleaning error:",e)}}),500)}catch(e){console.error("InsaneLink tracking error:",e)}}function t(n,o){if(navigator.sendBeacon)try{const t=new Blob([JSON.stringify(n)],{type:"application/json"});if(navigator.sendBeacon(e,t))return void console.log("InsaneLink: Successfully tracked page view using Beacon API")}catch(e){console.warn("InsaneLink: Beacon API failed, falling back to fetch",e)}try{fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),keepalive:!0}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);console.log("InsaneLink: Successfully tracked page view using fetch")})).catch((e=>{console.warn("InsaneLink: Fetch API failed",e),o<3?setTimeout((()=>{console.log(`InsaneLink: Retrying (${o+1}/3)...`),t(n,o+1)}),1e3*Math.pow(2,o)):i(n)}))}catch(e){console.error("InsaneLink: All tracking methods failed",e),i(n)}}function i(e){try{console.log("InsaneLink: Using pixel fallback method");const n={v:e.visitorId,l:e.linkId,t:Date.now(),r:encodeURIComponent(document.referrer).substring(0,100)},t=`https://linkmetrics-gamma.vercel.app/api/track-pixel?d=${encodeURIComponent(JSON.stringify(n))}`;(new Image).src=t}catch(e){console.error("InsaneLink: Pixel tracking failed",e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&n()}))}();
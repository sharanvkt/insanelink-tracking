/**
 * InsaneLink Tracking Script v1.0.0
 * Used to track landing page views for InsaneLink URL shortener
 * https://github.com/your-username/insanelink-tracking
 */
!function(){const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3000":"https://insanelink.your-company.com",n=`${e}/api/track`,o=`${e}/api/track-pixel`;function t(){try{const e=new URLSearchParams(window.location.search),n=e.get("insanelink_visitor"),o=e.get("insanelink_id");if(!n||!o)return;console.log(`InsaneLink: Recording page view for link ${o}`);i({visitorId:n,linkId:o,type:"page",url:window.location.href,referrer:document.referrer,timestamp:Date.now(),userAgent:navigator.userAgent,performanceData:{pageLoadTime:performance.now(),connectionType:navigator.connection?navigator.connection.effectiveType:null,deviceMemory:navigator.deviceMemory||null,screenWidth:window.screen.width,screenHeight:window.screen.height}},0),setTimeout((function(){try{if(window.history&&window.history.replaceState){const e=new URL(window.location.href);e.searchParams.delete("insanelink_visitor"),e.searchParams.delete("insanelink_id"),window.history.replaceState({},document.title,e.toString()),console.log("InsaneLink: Cleaned URL parameters")}}catch(e){console.error("InsaneLink: URL cleaning error:",e)}}),500)}catch(e){console.error("InsaneLink tracking error:",e)}}function i(e,o){if(navigator.sendBeacon)try{const o=new Blob([JSON.stringify(e)],{type:"application/json"});if(navigator.sendBeacon(n,o))return void console.log("InsaneLink: Successfully tracked page view using Beacon API")}catch(e){console.warn("InsaneLink: Beacon API failed, falling back to fetch",e)}try{fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).then((e=>{if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);console.log("InsaneLink: Successfully tracked page view using fetch")})).catch((n=>{console.warn("InsaneLink: Fetch API failed",n),o<3?setTimeout((()=>{console.log(`InsaneLink: Retrying (${o+1}/3)...`),i(e,o+1)}),1e3*Math.pow(2,o)):a(e)}))}catch(n){console.error("InsaneLink: All tracking methods failed",n),a(e)}}function a(e){try{console.log("InsaneLink: Using pixel fallback method");const n={v:e.visitorId,l:e.linkId,t:Date.now(),r:encodeURIComponent(document.referrer).substring(0,100)},t=`${o}?d=${encodeURIComponent(JSON.stringify(n))}`;(new Image).src=t}catch(e){console.error("InsaneLink: Pixel tracking failed",e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),document.addEventListener("visibilitychange",(function(){"visible"===document.visibilityState&&t()}))}();